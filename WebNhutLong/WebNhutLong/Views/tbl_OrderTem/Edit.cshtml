@model WebNhutLong.Models.DonHangView

@{
    ViewBag.Title = "Edit";
    Layout = "~/Views/Shared/_Layout_1.cshtml";
}

<h2>Create</h2>


<script type="text/javascript">
    function UpdateResultBaoGia(status)
    {
        var id = '@Model.BaoGiaTemView.id';
        var jsonObject = {
            'id': id,
            'status': status,
            'note': $('#baogia_note').val()
        };
        $.ajax({
            type: "POST",
            url: "@Url.Action("UpdateResultBaoGia")",
            contentType: "application/json; charset=utf-8",
        dataType: "json",
        data: JSON.stringify(jsonObject) ,
        success: function (data) {
            alert(data);
            document.location.reload();
        },
        failure: function (errMsg) {
            alert(errMsg);
        }
    });
       
    }
    function UpdateStatusOrder(status)
    {
        var id = '@Model.id';
        var jsonObject = {
            'id': id,
            'status': status
           
        };
        $.ajax({
            type: "POST",
            url: "@Url.Action("UpdateStatusOrder")",
            contentType: "application/json; charset=utf-8",
        dataType: "json",
        data: JSON.stringify(jsonObject) ,
        success: function (data) {
            alert(data);
            document.location.reload();
        },
        failure: function (errMsg) {
            alert(errMsg);
        }
    });
       
    }
    $(document).ready(function () {
        $("input[type=number]").keydown(function (e) {
            // Allow: backspace, delete, tab, escape, enter and .
            if ($.inArray(e.keyCode, [46, 8, 9, 27, 13, 110, 190]) !== -1 ||
                // Allow: Ctrl+A, Command+A
                (e.keyCode == 65 && (e.ctrlKey === true || e.metaKey === true)) ||
                // Allow: home, end, left, right, down, up
                (e.keyCode >= 35 && e.keyCode <= 40)) {
                // let it happen, don't do anything
                return;
            }
            // Ensure that it is a number and stop the keypress
            if ((e.shiftKey || (e.keyCode < 48 || e.keyCode > 57)) && (e.keyCode < 96 || e.keyCode > 105)) {
                e.preventDefault();
            }
        });

    });
    function updateProduct(el) {
        var id = new Date().getTime();
        var tr = $(el).parents('tr').eq(0);
        var trdata = "<tr id='ext_" + id + "'><input name='BaoGiaTemView.BaoGiaTemDetailViews.Index' value='" + id + "' type='hidden'/>";
        tr.find('.form-control').each(function() {
            if ($(this).attr('name') == 'SoLuong') {
                trdata += "<td><input class='form-control text-box single-line updateSL " + this.name + "'  min='1' value='" + this.value + "' type='number' name='BaoGiaTemView.BaoGiaTemDetailViews[" + id + "]." + this.name + "'/></td>";
            } else {
                trdata += "<td>" + this.value + "<input class='" + this.name + "' name='BaoGiaTemView.BaoGiaTemDetailViews[" + id + "]." + this.name + "' value='" + this.value + "' type='hidden'/></td>";
            }
            this.value = $(this).attr('default-value');
        });
        trdata += "<td><input type='submit' style='float: left; margin-left: 10px' value='Xóa' class='btn btn-primary' onclick='delProduct(this); return false;' /></td></tr>";
        $(el).parents('tbody').eq(0).append(trdata);
        updateMoney(el);
        updateEvent();
    }
    function updateEvent()
    {
        $('.updateSL').on("change", function () {
            updateMoney(this);
        });
        $("input[type=number]").keydown(function (e) {
            // Allow: backspace, delete, tab, escape, enter and .
            if ($.inArray(e.keyCode, [46, 8, 9, 27, 13, 110, 190]) !== -1 ||
                // Allow: Ctrl+A, Command+A
                (e.keyCode == 65 && (e.ctrlKey === true || e.metaKey === true)) ||
                // Allow: home, end, left, right, down, up
                (e.keyCode >= 35 && e.keyCode <= 40)) {
                // let it happen, don't do anything
                return;
            }
            // Ensure that it is a number and stop the keypress
            if ((e.shiftKey || (e.keyCode < 48 || e.keyCode > 57)) && (e.keyCode < 96 || e.keyCode > 105)) {
                e.preventDefault();
            }
        });
    }

    function delProduct(el) {
        var tr = $(el).parents('tr').eq(0);
        tr.remove();
        updateMoney(el);
          updateEvent();
    }

    function updateMoney(el)
    {
        var money = 0;
        $(el).parents('.body_data').eq(0).find('tr').each(function () {
            if($(this).attr('id')!=null)
            {

                money += parseInt($(this).find('.SoLuong').eq(0).val()) * parseFloat($(this).find('.GiaProducts').eq(0).val());
            }
        });
        $('.BaoGiaTemView_total_money').val(money);
        $('#BaoGiaTemView_total_money').text(money);
    }

</script>


@using (Html.BeginForm())
{
    @Html.AntiForgeryToken()
    @Html.ValidationSummary(true, "", new { @class = "text-danger" })

    <div class="panel panel-default">
        <div class="panel-heading">
            Mã khách hàng:<b>@Model.Customer.CodeCustomers</b><br />
            Tên khách hàng:<b>@Model.Customer.NameCustomers</b><br />
            Công ty:<b>@Model.Customer.CongTyCustomers</b>
        </div>
        <div class="panel-body">
            <div class="row form-horizontal">

                <div class="col-lg-6">
                    <div class="form-group">
                        <label class="col-md-4">Ngày bắt đầu thực tế</label>
                        <div class="col-md-8">
                            @Html.EditorFor(model => model.date_begin, new { htmlAttributes = new { @class = "form-control date" } })
                            @Html.ValidationMessageFor(model => model.date_begin, "", new { @class = "text-danger" })
                        </div>
                    </div>
                    <div class="form-group">
                        <label class="col-md-4">Mã đơn hàng</label>
                        <div class="col-md-8">
                            @Html.EditorFor(model => model.code, new { htmlAttributes = new { @class = "form-control" } })
                            @Html.ValidationMessageFor(model => model.code, "", new { @class = "text-danger" })
                            @Html.HiddenFor(model => model.customer_id)
                        </div>
                    </div>
                </div>
                <div class="col-lg-6">
                    <div class="form-group">
                        <label class="col-md-4">Ngày kết thúc thực tế</label>
                        <div class="col-md-8">
                            @Html.EditorFor(model => model.date_end, new { htmlAttributes = new { @class = "form-control date" } })
                            @Html.ValidationMessageFor(model => model.date_end, "", new { @class = "text-danger" })
                        </div>
                    </div>
                    <div class="form-group">
                        <label class="col-md-4">Trạng thái</label>
                        <div class="col-md-8">
                            @Html.HiddenFor(model => model.status)
                            @if (Model.status == 0)
                            {
                                <span>Đang báo giá</span>
                            }
                            @if (Model.status == 1)
                            {
                                <span>Đưa vào sản xuất</span>
                            }
                            @if (Model.status == 2)
                            {
                                <span>Đang vào sản xuất</span>
                            }
                            @if (Model.status == 3)
                            {
                                <span>Kết thúc đơn hàng</span>
                            }
                        </div>
                    </div>
                </div>
                <div class="col-lg-12">
                    <div class="form-group" style="text-align:center">
                       
                        <input type="submit" value="Cập nhật" class="btn btn-primary" />
                        <a class="btn btn-primary" href="@Url.Action("Index", "BaoGia", new { id = 1 })">
                            Hủy
                        </a>
                    </div>

                </div>
            </div>
            <!-- /.row (nested) -->
        </div>
    </div>
   
       

        
    
        if (Model.action==1)
        {

        <div class="panel panel-default">
            <div class="panel-heading">
                <div class="row">
                    <span style="margin-left: 10px;line-height:33px">Báo giá lần 2</span>
                </div>
            </div>

            <div class="panel-body">
                <div class="row">
                    <div class="col-lg-12 form-horizontal">
                        <div class="col-lg-6">
                            <div class="form-group">
                                <label class="col-md-4" for="date_begin">Ngày bất đầu</label>
                                <div class="col-md-8">
                                    <input class="form-control date" data-val="true" data-val-date="The field date_begin must be a date." name="BaoGiaTemView.date_begin" value="@DateTime.Now.ToString("MM/mm/yyyy")" type="hidden">
                                    @DateTime.Now.ToString("MM/dd/yyyy")
                                </div>

                            </div>

                            <div class="form-group">

                                <label class="col-md-4" for="total_money">Tổng tiền</label>
                                <div class="col-md-8">
                                    <input class="form-control BaoGiaTemView_total_money" data-val="true" data-val-number="The field total_money must be a number." name="BaoGiaTemView.total_money" value="" type="hidden">
                                    <span id="BaoGiaTemView_total_money">0</span> đ
                                </div>
                            </div>

                        </div>
                        <div class="col-lg-6">
                            <div class="form-group">
                                <label class="col-md-4" for="date_end">Ngày kết thúc</label>
                                <div class="col-md-8">
                                    <input class="form-control date" data-val="true" data-val-date="The field date_end must be a date." name="BaoGiaTemView.date_end" value="" type="hidden">
                                    Chờ cập nhật
                                </div>
                            </div>
                            <div class="form-group">
                                <label class="col-md-4" for="status">Trạng thái</label>
                                <div class="col-md-8">
                                    Tạo mới báo giá
                                </div>
                            </div>
                        </div>


                    </div>
                </div>
                <div class="row">
                    <div class="col-lg-12">
                        <table class="table table-striped table-bordered table-hover">
                            <thead>
                                <tr>
                                    <th width="150px" align="center" valign="middle">

                                        Tên sản phẩm
                                    </th>
                                    <th width="100px" align="center" valign="middle">
                                        Số lớp
                                    </th>
                                    <th width="*" align="center" valign="middle">
                                        Loại giấy
                                    </th>
                                    <th width="100px" align="center" valign="middle">
                                        Offset/Flexo
                                    </th>
                                    <th width="130px" align="center" valign="middle">
                                        Dán/Kim
                                    </th>
                                    <th width="150px" align="center" valign="middle">
                                        Quy Cách
                                    </th>
                                    <th width="150px" align="center" valign="middle">
                                        Giá
                                    </th>
                                    <th width="100px" align="center" valign="middle">
                                        Số lượng
                                    </th>
                                    <th></th>
                                </tr>
                            </thead>
                            <tbody class="body_data">
                                <tr>
                                    <td align="center">
                                        <input class="form-control text-box single-line" default-value="" name="NameProducts" type="text">
                                    </td>
                                    <td align="center">
                                        <input class="form-control text-box single-line" value="1" default-value="1" min="1" name="SolopProducts" type="number">
                                    </td>
                                    <td align="center">
                                        <select name="LoaigiayProducts" default-value="0" class="form-control valid">
                                            <option value="0">Chọn loại giấy</option>
                                            <option value="3 lớp: 2 Vàng 1 Xeo">3 lớp: 2 Vàng 1 Xeo</option>
                                            <option value="3 lớp: 1 Trắng 1 Xeo 1 Vàng">3 lớp: 1 Trắng 1 Xeo 1 Vàng</option>
                                            <option value="3 lớp: 1 Đài Loan 1 Xeo 1 Vàng">3 lớp: 1 Đài Loan 1 Xeo 1 Vàng</option>
                                            <option value="5 lớp: 2 Vàng 3 Xeo">5 lớp: 2 Vàng 3 Xeo</option>
                                            <option value="5 lớp: 1 Trắng 1 Vàng 3 Xeo">5 lớp: 1 Trắng 1 Vàng 3 Xeo</option>
                                            <option value="5 lớp: 1 Đài Loan 1 Vàng 3 Xeo">5 lớp: 1 Đài Loan 1 Vàng 3 Xeo</option>
                                            <option value="2 lớp: 1 Vàng 1 Xeo - sóng E">2 lớp: 1 Vàng 1 Xeo - sóng E</option>
                                            <option value="2 lớp: 1 Vàng 1 Xeo - sóng C">2 lớp: 1 Vàng 1 Xeo - sóng C</option>
                                            <option value="2 lớp: 1 Trắng 1 Xeo - sóng E">2 lớp: 1 Trắng 1 Xeo - sóng E</option>
                                        </select>

                                    </td>
                                    <td align="center">
                                        <select name="OffsetFlexoProducts" default-value="Offset" class="form-control">
                                            <option value="Offset">Offset</option>
                                            <option value="Flexo">Flexo</option>
                                        </select>
                                    </td>
                                    <td align="center">
                                        <select name="DanKimProducts" default-value="Dán keo" class="form-control">
                                            <option value="Dán keo">Dán keo</option>
                                            <option value="Đóng kim">Đóng kim</option>
                                        </select>
                                    </td>
                                    <td align="center">
                                        <input class="form-control text-box single-line" default-value="" name="QuyCachProducts" type="text">
                                    </td>

                                    <td align="center">
                                        <input class="form-control text-box single-line" name="GiaProducts" step="500" min="0" default-value="0" value="0" type="number">
                                    </td>
                                    <td align="center">
                                        <input class="form-control text-box single-line" default-value="1" min="1" name="SoLuong" value="1" type="number">
                                    </td>
                                    <td align="center"><input type="submit" style="float: left; margin-left: 10px" value="Thêm" class="btn btn-primary" onclick="updateProduct(this); return false;" /></td>

                                </tr>
                            </tbody>
                        </table>
                    </div>
                    <!-- /.col-lg-12 -->
                </div>
            </div>
        </div>

        }
     <div class="panel panel-default">
        <div class="panel-heading">
            <div class="row">
                <span style="margin-left: 10px;line-height:33px">Báo giá lần 1</span>
                <input type="submit" style="float: right; margin-right: 10px" value="In báo giá" class="btn btn-primary" />
                @if (Model.BaoGiaTemView.status.Value == 0)
                {
                    <input type="button"  data-toggle="modal" data-target="#modal-container"  style="float: right; margin-right: 10px" value="Cập nhật kết quả" class="btn btn-primary" />
                }
                @if (Model.BaoGiaTemView.status.Value == 2)
                {
                    <input type="submit" style="float: right; margin-right: 10px" value="Thêm mới báo giá" class="btn btn-primary" />
                }
                @if (Model.BaoGiaTemView.status.Value == 1 && Model.status == 0)
                {
                    <input type="button" style="float: right; margin-right: 10px" value="Đưa vào sản xuất" onclick="UpdateStatusOrder(1);" class="btn btn-primary" />
                }
            </div>
        </div>
        <div class="panel-body">
            <div class="row">
                <div class="col-lg-12 form-horizontal">
                    <div class="col-lg-6 ">

                        <div class="form-group">
                            <label class="control-label col-md-4" for="date_begin">Ngày bất đầu</label>
                            <div class="col-md-8" style="padding-top:7px">
                                @Model.BaoGiaTemView.date_begin.Value.ToString("dd/MM/yyyy")
                            </div>
                        </div>
                        <div class="form-group ">

                            <label class="control-label col-md-4" for="total_money">Tổng tiền</label>
                            <div class="col-md-8" style="padding-top:7px">
                               @Model.BaoGiaTemView.total_money.Value đ
                            </div>
                        </div>

                    </div>
                    <div class="col-lg-6 ">
                        <div class="form-group">

                            <label class="control-label col-md-4" for="date_end">Ngày kết thúc</label>
                            <div class="col-md-8" style="padding-top:7px">
                               @Model.BaoGiaTemView.date_end.Value.ToString("dd/MM/yyyy")
                            </div>

                        </div>

                        <div class="form-group">

                            <label class="control-label col-md-4" for="status">Trạng thái</label>
                            <div class="col-md-8" style="padding-top:7px">
                               @if (Model.BaoGiaTemView.status == 0)
                               {
                                    <span>Chờ kết quả báo giá</span>
                               }
                                @if (Model.BaoGiaTemView.status == 1)
                                {
                                    <span>Đồng ý</span>
                                }
                                @if (Model.BaoGiaTemView.status == 2)
                                {
                                    <span>Từ chối</span>
                                }
                            </div>
                        </div>
                    </div>

                </div>
            </div>

            <div class="row">
                <div class="col-lg-12">


                    <table class="table table-striped table-bordered table-hover">
                        <thead>
                            <tr>
                                <th>
                                    Tên sản phẩm
                                </th>
                                <th>
                                   Số lớp
                                </th>
                                <th>
                                    Loại giấy
                                </th>
                                <th>
                                    Offset/Flexo
                                </th>
                                <th>
                                    Dán/Kim
                                </th>
                                <th>
                                    Quy Cách
                                </th>
                                <th>
                                    Giá
                                </th>
                                <th>
                                    Số lượng
                                </th>

                            </tr>
                        </thead>
                        <tbody class="body_data">
                            @foreach (var item in Model.BaoGiaTemView.BaoGiaTemDetailViews)
                            {
                                <tr >
                                    <td>@item.NameProducts</td>
                                    <td>@item.SolopProducts</td>
                                    <td>@item.LoaigiayProducts</td>
                                    <td>@item.OffsetFlexoProducts</td>
                                    <td>@item.DanKimProducts</td>
                                    <td>@item.QuyCachProducts</td>
                                    <td>@item.GiaProducts</td>
                                    <td>@item.SoLuong</td>
                                </tr>
                            }                            
                        </tbody>
                    </table>

                </div>
                <!-- /.col-lg-12 -->
            </div>

        </div>
    </div>
     <!-- Trigger the modal with a button -->
   

  <!-- Modal -->
    <div id="modal-container" class="modal fade" tabindex="-1" role="dialog">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                Cập nhật kết quả
            </div>
            <div class="modal-body">
                <textarea class="form-control" id="baogia_note" placeholder="Try to input multiple lines here..."></textarea>
            </div>
            <div class="modal-footer">
                <div class="bootstrap-dialog-footer-buttons">
                    <button class="btn btn-primary" onclick="">Đồng ý</button>
                    <button class="btn btn-warning" ><span class="bootstrap-dialog-button-icon glyphicon glyphicon-ban-circle"></span>Từ chối</button>
                </div>
            </div>
        </div>
    </div>
</div>
}

<div>
    @Html.ActionLink("Back to List", "Index")
</div>

@section Scripts {
    @Scripts.Render("~/bundles/jqueryval")
}
<style>
    .table td {
        text-align: center;
    }

    .table th {
        text-align: center;
    }
</style>